<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Data Reports</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="reports-body">
<header class="site-header">
  <div class="container site-header-inner">
    <h1 class="site-title">Data Reports</h1>
    <nav class="site-nav">
      <a href="{{ url_for('index') }}">Home</a>
      {% if session.get('role') == 'admin' %}
      <a href="{{ url_for('admin_dashboard') }}">Admin</a>
      {% endif %}
      {% if session.get('role') == 'employee' %}
      <a href="{{ url_for('employee_dashboard') }}">Employee</a>
      {% endif %}
      {% if session.get('role') == 'department' %}
      <a href="{{ url_for('department_dashboard') }}">Department</a>
      {% endif %}
      <a href="{{ url_for('logout') }}">Logout</a>
    </nav>
  </div>
</header>

<main class="container reports-page">
  <section class="reports-filters card">
    <h2 class="section-title">Filters</h2>
    <form method="post" action="{{ url_for('reports') }}" class="filters-grid">
      <div class="form-field">
        <label for="date_from">From</label>
        <input type="date" id="date_from" name="date_from" value="{{ request.form.get('date_from', '') }}">
      </div>
      <div class="form-field">
        <label for="date_to">To</label>
        <input type="date" id="date_to" name="date_to" value="{{ request.form.get('date_to', '') }}">
      </div>
      <div class="form-field">
        <label for="department_id">Department</label>
        {% if departments %}
        <select id="department_id" name="department_id">
          <option value="">All</option>
          {% for d in departments %}
          <option value="{{ d.id }}" {% if request.form.get('department_id')==str(d.id) %}selected{% endif %}>{{ d.name }}</option>
          {% endfor %}
        </select>
        {% else %}
        <input type="text" id="department_id" name="department_id" value="{{ request.form.get('department_id', '') }}" placeholder="ID">
        {% endif %}
      </div>
      <div class="form-field">
        <label for="employee_id">Employee</label>
        {% if employees %}
        <select id="employee_id" name="employee_id">
          <option value="">All</option>
          {% for e in employees %}
          <option value="{{ e.id }}" {% if request.form.get('employee_id')==str(e.id) %}selected{% endif %}>{{ e.name }}</option>
          {% endfor %}
        </select>
        {% else %}
        <input type="text" id="employee_id" name="employee_id" value="{{ request.form.get('employee_id', '') }}" placeholder="ID">
        {% endif %}
      </div>
      <div class="form-field form-field-wide">
        <label for="product_name">Product</label>
        <input type="text" id="product_name" name="product_name" value="{{ request.form.get('product_name', '') }}" placeholder="Name contains">
      </div>
      <div class="filters-actions">
        <button type="submit" class="btn primary">Apply Filters</button>
        <a class="btn ghost" href="{{ url_for('reports') }}">Reset</a>
      </div>
    </form>
  </section>

  <section class="reports-summary">
    {% if summary %}
    <div class="summary-grid">
      {% if summary.total_revenue is not none %}
      <div class="card summary-card">
        <div class="summary-label">Total Revenue</div>
        <div class="summary-value">{{ "{:,.2f}".format(summary.total_revenue) }}</div>
      </div>
      {% endif %}
      {% if summary.total_transactions is not none %}
      <div class="card summary-card">
        <div class="summary-label">Total Transactions</div>
        <div class="summary-value">{{ summary.total_transactions }}</div>
      </div>
      {% endif %}
      {% if summary.average_order_value is not none %}
      <div class="card summary-card">
        <div class="summary-label">Average Order Value</div>
        <div class="summary-value">{{ "{:,.2f}".format(summary.average_order_value) }}</div>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </section>

  <section class="reports-results card">
    <h2 class="section-title">Results</h2>
    {% if results and results|length > 0 %}
    <div class="table-wrap">
      <table class="report-table">
        <thead>
          <tr>
            {% for k, v in results[0].items() %}
            <th>{{ k.replace('_',' ').title() }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in results %}
          <tr>
            {% for k, v in row.items() %}
            <td>
              {% if v is number %}
              {{ v }}
              {% else %}
              {{ v }}
              {% endif %}
            </td>
            {% endfor %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <div class="empty-title">No results</div>
      <div class="empty-text">Adjust filters and try again.</div>
    </div>
    {% endif %}
  </section>
</main>
</body>
</html>
